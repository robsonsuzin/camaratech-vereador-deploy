import{r as p,R as _,S as E,U as f,V as o,X as R,Y as l,a1 as L,a5 as U,Z as k,a3 as Q,a0 as A,aW as F,ab as z,W as $,G as J,aX as D,_ as M,aa as W,u as X,a9 as Y,aY as Z,a4 as V,ag as c,aI as G,aJ as K,ac as H,a2 as N,aZ as ee,a8 as B,ae as P,aS as te,a_ as ae}from"./index.c07dbf11.js";import{Q as se}from"./QForm.54f5701f.js";import{Q as oe}from"./QPage.b9a6a4dd.js";import{u as le}from"./socket.eb8b7e4e.js";const ie={class:"tw-flex tw-items-center"},re={class:"text-subtitle q-mb-none"},ne={key:0},y={__name:"CardInfo",props:{visible:{type:Boolean,default:!0},type:String,title:String,msg:String,icon:String,color:String,noicon:Boolean,class:String,compact:{type:Boolean,default:!1},btn:{type:Boolean,default:!1},btnProps:{type:Object,default:()=>({color:"primary",size:"sm",outlined:!0,label:"A\xE7\xE3o"})}},emits:["btnClick"],setup(I,{emit:n}){const s=I,b=n,d=p(),i=p();function u(){b("btnClick")}function m(){var g,v,w,x,r,S,q,C;return s.type==="warning"&&(d.value=(g=s.color)!=null?g:"orange",i.value=(v=s.icon)!=null?v:"warning"),s.type==="success"&&(d.value=(w=s.color)!=null?w:"green",i.value=(x=s.icon)!=null?x:"check_circle"),s.type==="error"&&(d.value=(r=s.color)!=null?r:"red",i.value=(S=s.icon)!=null?S:"error"),s.type==="info"&&(d.value=(q=s.color)!=null?q:"blue",i.value=(C=s.icon)!=null?C:"info"),i.value=s.noicon?null:i.value,s.compact?"col-12 text-subtitle text-weight-light bg-"+d.value+"-1 "+s.class:"col-12 text-h6 text-weight-light q-mb-md bg-"+d.value+"-1 "+s.class}return(g,v)=>s.visible?(_(),E($,{key:0,flat:"",bordered:"",class:z(m())},{default:f(()=>[o(R,{class:"tw-flex tw-items-center tw-justify-between"},{default:f(()=>[l("div",ie,[I.noicon?U("",!0):(_(),E(L,{key:0,name:i.value,color:d.value,size:s.compact==!0?"1.3rem":"2rem",class:"tw-pr-3"},null,8,["name","color","size"])),l("div",null,[l("b",null,k(s.title),1),l("p",re,k(s.msg),1)])]),s.btn?(_(),Q("div",ne,[o(A,F(s.btnProps,{onClick:u}),null,16)])):U("",!0)]),_:1})]),_:1},8,["class"])):U("",!0)}};function ue(){return J(D)}const ce={class:"tw-bg-white tw-p-6 tw-border tw-shadow-lg tw-rounded-lg",style:{width:"500px"}},de={key:0,class:"q-mb-md"},me={class:"row q-gutter-sm"},ve={class:"row items-center"},pe={class:"col-auto"},fe={class:"col q-ml-sm"},ge={class:"text-subtitle2"},ye={class:"text-caption"},_e={class:"col-auto"},be={class:"col-12"},we={class:"tw-flex tw-justify-between tw-items-center tw-mt-0"},xe={__name:"Login",setup(I){const n=ue(),s=W(),b=X(),d=Y(),i=Z(),u=p(n.cookies.get("cookie_email")),m=p(n.cookies.get("cookie_password")),g=p(!1),v=p(null),w=p(Boolean(n.cookies.get("cookie_remember"))),x=p({error:null,message:null}),r=p([]);function S(){const e=n.cookies.get("saved_users");if(e)try{typeof e=="string"?r.value=JSON.parse(e):Array.isArray(e)?r.value=e:r.value=[]}catch(t){console.error("Erro ao carregar usu\xE1rios salvos:",t),r.value=[]}}function q(e){const t=r.value.findIndex(a=>a.email===e.email);t>=0?r.value[t]=e:(r.value.length>=5&&r.value.shift(),r.value.push(e)),n.cookies.set("saved_users",JSON.stringify(r.value),{expires:30,path:"/"})}function C(e){v.value=e,u.value=e.email,m.value=e.password||""}function j(e){var t;r.value=r.value.filter(a=>a.email!==e),n.cookies.set("saved_users",JSON.stringify(r.value),{expires:30,path:"/"}),((t=v.value)==null?void 0:t.email)===e&&(v.value=null)}S();async function O(){if(g.value=!0,!u.value&&!m.value){B.error("Preencha o e-mail e senha para entrar!"),g.value=!1;return}await s.login(u.value,m.value).then(async e=>{if(console.log(e),e.data.data.units.find(h=>h.token==P.getItem("unit_id"))||P.setItem("unit_id",e.data.data.units[0].token),await b.getMe(),!b.user){B.error("N\xE3o foi poss\xEDvel carregar seus dados (API /me retornou 401). Verifique a configura\xE7\xE3o do Sanctum e se o dom\xEDnio/porta est\xE3o corretos.");return}if(w.value){n.cookies.set("cookie_email",u.value),n.cookies.set("cookie_password",m.value),n.cookies.set("cookie_remember",!0);const h={email:u.value,name:e.data.data.first_name+" "+e.data.data.last_name,password:m.value};q(h)}B.success("Bem-Vindo ao CamaraTech Vereador! :)");const a=le();setTimeout(()=>{a.isConnected&&b.user&&a.sendIdentify(b)},500),d.push({name:"dashboard"})}).catch(e=>{console.log(e),x.value=e.response.data,B.error(e.response.data.message)}).finally(()=>{g.value=!1})}return(e,t)=>(_(),E(oe,{class:"flex flex-center bg-grey-3"},{default:f(()=>[l("div",ce,[t[6]||(t[6]=l("div",{class:"tw-font-sans tw-text-3xl tw-pt-2 tw-text-center text-primary"},[l("b",null,"Camara"),V("Tech ")],-1)),t[7]||(t[7]=l("div",{class:"tw-font-sans tw-text-2xl tw-pb-8 tw-pt-2 tw-text-center text-primary"}," VEREADOR ",-1)),o(y,{visible:Boolean(c(i).query.register),type:"warning",title:"Ol\xE1, "+c(i).query.first_name,msg:"Foi enviado uma mensagem no seu whatsapp pra confirma\xE7\xE3o da conta!"},null,8,["visible","title"]),o(y,{visible:Boolean(c(i).query.confirm),type:"success",title:c(i).query.first_name,msg:"Sua conta foi confirmada com sucesso, digite sua senha para entrar!"},null,8,["visible","title"]),o(y,{visible:Boolean(c(i).query.reset),type:"success",title:c(i).query.first_name,msg:"Sua senha foi alterada com sucesso!"},null,8,["visible","title"]),o(y,{visible:Boolean(c(i).query.error==="InvalidConfirmationException"),type:"error",title:"Que Pena!",msg:"Token inv\xE1lido, vc precisa solicitar em Recuperar Acesso!"},null,8,["visible"]),o(y,{visible:Boolean(c(i).query.error==="TokenInvalidException"),type:"error",title:"Que Pena!",msg:"Token inv\xE1lido, vc precisa solicitar em Recuperar Acesso!"},null,8,["visible"]),o(y,{visible:Boolean(c(i).query.error==="UserAlreadyVerifiedException"),type:"success",title:"Tudo Certo! :)",msg:"Seu usu\xE1rio j\xE1 est\xE1 verificado!"},null,8,["visible"]),o(y,{visible:Boolean(c(i).query.error==="UserAlreadyVerifiedException"),type:"success",title:"Tudo Certo! :)",msg:"Seu usu\xE1rio j\xE1 est\xE1 verificado!"},null,8,["visible"]),o(y,{visible:x.value.exception==="AuthException",type:"warning",title:"Falha na autentica\xE7\xE3o!",msg:x.value.message},null,8,["visible","msg"]),r.value.length>0?(_(),Q("div",de,[t[3]||(t[3]=l("div",{class:"text-subtitle2 text-grey-7 q-mb-sm"},"Usu\xE1rios Salvos",-1)),l("div",me,[(_(!0),Q(G,null,K(r.value,a=>{var h;return _(),Q("div",{key:a.email,class:"col-12"},[o($,{flat:"",bordered:"",class:z(["cursor-pointer hover-card",{"bg-primary text-white":((h=v.value)==null?void 0:h.email)===a.email}]),onClick:T=>C(a)},{default:f(()=>[o(R,{class:"q-pa-sm"},{default:f(()=>{var T;return[l("div",ve,[l("div",pe,[o(te,{size:"40px",color:((T=v.value)==null?void 0:T.email)===a.email?"white":"primary","text-color":"primary"},{default:f(()=>[V(k(a.name.charAt(0).toUpperCase()),1)]),_:2},1032,["color"])]),l("div",fe,[l("div",ge,k(a.name),1),l("div",ye,k(a.email),1)]),l("div",_e,[o(A,{flat:"",dense:"",round:"",icon:"close",size:"sm",onClick:ae(he=>j(a.email),["stop"])},null,8,["onClick"])])])]}),_:2},1024)]),_:2},1032,["class","onClick"])])}),128))]),o(H,{class:"q-my-md"})])):U("",!0),l("div",be,[o(se,{onSubmit:O,class:"q-gutter-y-sm"},{default:f(()=>[o(N,{outlined:"",class:"q-pb-lg",modelValue:u.value,"onUpdate:modelValue":t[0]||(t[0]=a=>u.value=a),label:"Email",autocomplete:"email",rules:[a=>!!a||"Digite o email"]},null,8,["modelValue","rules"]),o(N,{outlined:"",class:"q-pb-lg",modelValue:m.value,"onUpdate:modelValue":t[1]||(t[1]=a=>m.value=a),type:"password",label:"Senha",autocomplete:"current-password",rules:[a=>!!a||"Digite sua senha"]},null,8,["modelValue","rules"]),l("div",null,[o(ee,{modelValue:w.value,"onUpdate:modelValue":t[2]||(t[2]=a=>w.value=a),label:"Lembrar dados!","false-value":!1,"true-value":!0,"right-label":""},null,8,["modelValue"])]),l("div",we,[o(A,{flat:"",to:"/login/esqueci-senha/?email="+u.value,class:"text-black-50"},{default:f(()=>[...t[4]||(t[4]=[V("Recuperar Acesso?",-1)])]),_:1},8,["to"]),o(A,{class:"tw-px-5 tw-py-3 tw-rounded-lg",color:"primary",size:"md",type:"submit",loading:g.value},{default:f(()=>[...t[5]||(t[5]=[V("Entrar",-1)])]),_:1},8,["loading"])])]),_:1})])])]),_:1}))}};var Ve=M(xe,[["__scopeId","data-v-7e5c370d"]]);export{Ve as default};
