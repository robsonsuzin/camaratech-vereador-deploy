import{r as g,R as b,S as N,U as y,V as o,X as $,Y as i,a1 as F,a5 as U,Z as q,a3 as A,a0 as I,aX as J,ab as z,W as j,G as D,aY as M,_ as X,aa as Y,u as Z,a9 as G,aZ as K,a4 as V,ag as u,aI as W,aJ as H,ac as ee,a2 as P,a_ as te,a8 as Q,ae as R,aQ as ae,a$ as se}from"./index.7364dde9.js";import{Q as oe}from"./QForm.8791448d.js";import{Q as le}from"./QPage.4ca47673.js";import{u as ie}from"./socket.6fd611a7.js";const re={class:"tw-flex tw-items-center"},ne={class:"text-subtitle q-mb-none"},ue={key:0},f={__name:"CardInfo",props:{visible:{type:Boolean,default:!0},type:String,title:String,msg:String,icon:String,color:String,noicon:Boolean,class:String,compact:{type:Boolean,default:!1},btn:{type:Boolean,default:!1},btnProps:{type:Object,default:()=>({color:"primary",size:"sm",outlined:!0,label:"A\xE7\xE3o"})}},emits:["btnClick"],setup(T,{emit:n}){const s=T,w=n,c=g(),l=g();function d(){w("btnClick")}function m(){var _,v,x,h,r,S,C,B;return s.type==="warning"&&(c.value=(_=s.color)!=null?_:"orange",l.value=(v=s.icon)!=null?v:"warning"),s.type==="success"&&(c.value=(x=s.color)!=null?x:"green",l.value=(h=s.icon)!=null?h:"check_circle"),s.type==="error"&&(c.value=(r=s.color)!=null?r:"red",l.value=(S=s.icon)!=null?S:"error"),s.type==="info"&&(c.value=(C=s.color)!=null?C:"blue",l.value=(B=s.icon)!=null?B:"info"),l.value=s.noicon?null:l.value,s.compact?"col-12 text-subtitle text-weight-light bg-"+c.value+"-1 "+s.class:"col-12 text-h6 text-weight-light q-mb-md bg-"+c.value+"-1 "+s.class}return(_,v)=>s.visible?(b(),N(j,{key:0,flat:"",bordered:"",class:z(m())},{default:y(()=>[o($,{class:"tw-flex tw-items-center tw-justify-between"},{default:y(()=>[i("div",re,[T.noicon?U("",!0):(b(),N(F,{key:0,name:l.value,color:c.value,size:s.compact==!0?"1.3rem":"2rem",class:"tw-pr-3"},null,8,["name","color","size"])),i("div",null,[i("b",null,q(s.title),1),i("p",ne,q(s.msg),1)])]),s.btn?(b(),A("div",ue,[o(I,J(s.btnProps,{onClick:d}),null,16)])):U("",!0)]),_:1})]),_:1},8,["class"])):U("",!0)}};function ce(){return D(M)}const de={class:"tw-bg-white tw-p-6 tw-border tw-shadow-lg tw-rounded-lg",style:{width:"500px"}},me={key:0,class:"q-mb-md"},ve={class:"row q-gutter-sm"},pe={class:"row items-center"},fe={class:"col-auto"},ge={class:"col q-ml-sm"},ye={class:"text-subtitle2"},_e={class:"text-caption"},be={class:"col-auto"},we={class:"col-12"},xe={class:"tw-flex tw-justify-between tw-items-center tw-mt-0"},he={__name:"Login",setup(T){const n=ce(),s=Y(),w=Z(),c=G(),l=K(),d=g(n.cookies.get("cookie_email")),m=g(n.cookies.get("cookie_password")),_=g(!1),v=g(null),x=g(Boolean(n.cookies.get("cookie_remember"))),h=g({error:null,message:null}),r=g([]);function S(){const e=n.cookies.get("saved_users");if(e)try{typeof e=="string"?r.value=JSON.parse(e):Array.isArray(e)?r.value=e:r.value=[]}catch(t){console.error("Erro ao carregar usu\xE1rios salvos:",t),r.value=[]}}function C(e){const t=r.value.findIndex(a=>a.email===e.email);t>=0?r.value[t]=e:(r.value.length>=5&&r.value.shift(),r.value.push(e)),n.cookies.set("saved_users",JSON.stringify(r.value),{expires:30,path:"/"})}function B(e){v.value=e,d.value=e.email,m.value=e.password||""}function O(e){var t;r.value=r.value.filter(a=>a.email!==e),n.cookies.set("saved_users",JSON.stringify(r.value),{expires:30,path:"/"}),((t=v.value)==null?void 0:t.email)===e&&(v.value=null)}S();async function L(){if(_.value=!0,!d.value&&!m.value){Q.error("Preencha o e-mail e senha para entrar!"),_.value=!1;return}await s.login(d.value,m.value).then(async e=>{if(console.log(e),e.data.data.units.find(p=>p.token==R.getItem("unit_id"))||R.setItem("unit_id",e.data.data.units[0].token),await w.getMe(),!w.user){Q.error("N\xE3o foi poss\xEDvel carregar seus dados (API /me retornou 401). Verifique a configura\xE7\xE3o do Sanctum e se o dom\xEDnio/porta est\xE3o corretos.");return}if(x.value){n.cookies.set("cookie_email",d.value),n.cookies.set("cookie_password",m.value),n.cookies.set("cookie_remember",!0);const p={email:d.value,name:e.data.data.first_name+" "+e.data.data.last_name,password:m.value};C(p)}Q.success("Bem-Vindo ao CamaraTech Vereador! :)");const a=ie();setTimeout(()=>{a.isConnected&&w.user&&a.sendIdentify(w)},500),c.push({name:"dashboard"})}).catch(async e=>{var a,p,k,E;console.log(e),h.value=((a=e.response)==null?void 0:a.data)||{};const t=((k=(p=e.response)==null?void 0:p.data)==null?void 0:k.message)||"Erro ao entrar.";Q.error(t),((E=e.response)==null?void 0:E.status)===403&&(await s.logout(),t.includes("proponente")&&c.replace({name:"login",query:{error:"no_proponent"}}))}).finally(()=>{_.value=!1})}return(e,t)=>(b(),N(le,{class:"flex flex-center bg-grey-3"},{default:y(()=>[i("div",de,[t[6]||(t[6]=i("div",{class:"tw-font-sans tw-text-3xl tw-pt-2 tw-text-center text-primary"},[i("b",null,"Camara"),V("Tech ")],-1)),t[7]||(t[7]=i("div",{class:"tw-font-sans tw-text-2xl tw-pb-8 tw-pt-2 tw-text-center text-primary"}," VEREADOR ",-1)),o(f,{visible:Boolean(u(l).query.register),type:"warning",title:"Ol\xE1, "+u(l).query.first_name,msg:"Foi enviado uma mensagem no seu whatsapp pra confirma\xE7\xE3o da conta!"},null,8,["visible","title"]),o(f,{visible:Boolean(u(l).query.confirm),type:"success",title:u(l).query.first_name,msg:"Sua conta foi confirmada com sucesso, digite sua senha para entrar!"},null,8,["visible","title"]),o(f,{visible:Boolean(u(l).query.reset),type:"success",title:u(l).query.first_name,msg:"Sua senha foi alterada com sucesso!"},null,8,["visible","title"]),o(f,{visible:Boolean(u(l).query.error==="InvalidConfirmationException"),type:"error",title:"Que Pena!",msg:"Token inv\xE1lido, vc precisa solicitar em Recuperar Acesso!"},null,8,["visible"]),o(f,{visible:Boolean(u(l).query.error==="TokenInvalidException"),type:"error",title:"Que Pena!",msg:"Token inv\xE1lido, vc precisa solicitar em Recuperar Acesso!"},null,8,["visible"]),o(f,{visible:Boolean(u(l).query.error==="UserAlreadyVerifiedException"),type:"success",title:"Tudo Certo! :)",msg:"Seu usu\xE1rio j\xE1 est\xE1 verificado!"},null,8,["visible"]),o(f,{visible:Boolean(u(l).query.error==="UserAlreadyVerifiedException"),type:"success",title:"Tudo Certo! :)",msg:"Seu usu\xE1rio j\xE1 est\xE1 verificado!"},null,8,["visible"]),o(f,{visible:h.value.exception==="AuthException",type:"warning",title:"Falha na autentica\xE7\xE3o!",msg:h.value.message},null,8,["visible","msg"]),o(f,{visible:Boolean(u(l).query.error==="no_proponent"),type:"warning",title:"Acesso n\xE3o permitido",msg:"N\xE3o h\xE1 proponente (parlamentar) vinculado \xE0 sua conta. Entre em contato com o administrador para vincular seu usu\xE1rio a um vereador."},null,8,["visible"]),r.value.length>0?(b(),A("div",me,[t[3]||(t[3]=i("div",{class:"text-subtitle2 text-grey-7 q-mb-sm"},"Usu\xE1rios Salvos",-1)),i("div",ve,[(b(!0),A(W,null,H(r.value,a=>{var p;return b(),A("div",{key:a.email,class:"col-12"},[o(j,{flat:"",bordered:"",class:z(["cursor-pointer hover-card",{"bg-primary text-white":((p=v.value)==null?void 0:p.email)===a.email}]),onClick:k=>B(a)},{default:y(()=>[o($,{class:"q-pa-sm"},{default:y(()=>{var k;return[i("div",pe,[i("div",fe,[o(ae,{size:"40px",color:((k=v.value)==null?void 0:k.email)===a.email?"white":"primary","text-color":"primary"},{default:y(()=>[V(q(a.name.charAt(0).toUpperCase()),1)]),_:2},1032,["color"])]),i("div",ge,[i("div",ye,q(a.name),1),i("div",_e,q(a.email),1)]),i("div",be,[o(I,{flat:"",dense:"",round:"",icon:"close",size:"sm",onClick:se(E=>O(a.email),["stop"])},null,8,["onClick"])])])]}),_:2},1024)]),_:2},1032,["class","onClick"])])}),128))]),o(ee,{class:"q-my-md"})])):U("",!0),i("div",we,[o(oe,{onSubmit:L,class:"q-gutter-y-sm"},{default:y(()=>[o(P,{outlined:"",class:"q-pb-lg",modelValue:d.value,"onUpdate:modelValue":t[0]||(t[0]=a=>d.value=a),label:"Email",autocomplete:"email",rules:[a=>!!a||"Digite o email"]},null,8,["modelValue","rules"]),o(P,{outlined:"",class:"q-pb-lg",modelValue:m.value,"onUpdate:modelValue":t[1]||(t[1]=a=>m.value=a),type:"password",label:"Senha",autocomplete:"current-password",rules:[a=>!!a||"Digite sua senha"]},null,8,["modelValue","rules"]),i("div",null,[o(te,{modelValue:x.value,"onUpdate:modelValue":t[2]||(t[2]=a=>x.value=a),label:"Lembrar dados!","false-value":!1,"true-value":!0,"right-label":""},null,8,["modelValue"])]),i("div",xe,[o(I,{flat:"",to:"/login/esqueci-senha/?email="+d.value,class:"text-black-50"},{default:y(()=>[...t[4]||(t[4]=[V("Recuperar Acesso?",-1)])]),_:1},8,["to"]),o(I,{class:"tw-px-5 tw-py-3 tw-rounded-lg",color:"primary",size:"md",type:"submit",loading:_.value},{default:y(()=>[...t[5]||(t[5]=[V("Entrar",-1)])]),_:1},8,["loading"])])]),_:1})])])]),_:1}))}};var Ve=X(he,[["__scopeId","data-v-21ea128f"]]);export{Ve as default};
